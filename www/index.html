<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <title>CDDL Playground</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #0f1117;
      --bg-elevated: #161822;
      --bg-surface: #1c1e2d;
      --bg-hover: #252839;
      --border: #2a2d3e;
      --border-focus: #4f46e5;
      --text: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --accent-subtle: rgba(99, 102, 241, 0.1);
      --success: #22c55e;
      --success-subtle: rgba(34, 197, 94, 0.1);
      --success-border: rgba(34, 197, 94, 0.25);
      --error: #f43f5e;
      --error-subtle: rgba(244, 63, 94, 0.08);
      --error-border: rgba(244, 63, 94, 0.2);
      --warning: #f59e0b;
      --warning-subtle: rgba(245, 158, 11, 0.1);
      --radius: 8px;
      --radius-sm: 5px;
      --radius-lg: 12px;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.4);
      --transition: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.light {
      --bg: #f8f9fc;
      --bg-elevated: #ffffff;
      --bg-surface: #f0f1f5;
      --bg-hover: #e8e9ef;
      --border: #d4d6de;
      --border-focus: #4f46e5;
      --text: #1e293b;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --accent: #4f46e5;
      --accent-hover: #6366f1;
      --accent-subtle: rgba(79, 70, 229, 0.08);
      --success: #16a34a;
      --success-subtle: rgba(22, 163, 74, 0.08);
      --success-border: rgba(22, 163, 74, 0.2);
      --error: #e11d48;
      --error-subtle: rgba(225, 29, 72, 0.06);
      --error-border: rgba(225, 29, 72, 0.15);
      --warning: #d97706;
      --warning-subtle: rgba(217, 119, 6, 0.08);
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ── Top bar ── */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.25rem;
      height: 48px;
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      z-index: 10;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .logo-mark {
      width: 22px;
      height: 22px;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      font-weight: 700;
      color: white;
      letter-spacing: 0;
    }

    .topbar-center {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.65rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      transition: background var(--transition), color var(--transition), border-color var(--transition);
      border: 1px solid var(--border);
      background: var(--bg-surface);
      color: var(--text-secondary);
    }

    .status-pill.valid {
      background: var(--success-subtle);
      border-color: var(--success-border);
      color: var(--success);
    }

    .status-pill.invalid {
      background: var(--error-subtle);
      border-color: var(--error-border);
      color: var(--error);
    }

    .status-pill.checking {
      background: var(--warning-subtle);
      border-color: rgba(245, 158, 11, 0.25);
      color: var(--warning);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      flex-shrink: 0;
    }

    .status-pill.checking .status-dot {
      animation: blink 1.2s ease-in-out infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* ── Ref-check toggle ── */
    .toggle-group {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      cursor: pointer;
      user-select: none;
      padding: 0.25rem 0.4rem;
      border-radius: var(--radius-sm);
      transition: color var(--transition);
    }

    .toggle-group:hover {
      color: var(--text-secondary);
    }

    .toggle-track {
      position: relative;
      width: 30px;
      height: 16px;
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 9999px;
      transition: background var(--transition), border-color var(--transition);
      flex-shrink: 0;
    }

    .toggle-track.active {
      background: var(--accent);
      border-color: var(--accent);
    }

    .toggle-knob {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 10px;
      height: 10px;
      background: var(--text-muted);
      border-radius: 50%;
      transition: transform var(--transition), background var(--transition);
    }

    .toggle-track.active .toggle-knob {
      transform: translateX(14px);
      background: white;
    }

    /* ── Warning styling ── */
    .problem-row.warning .problem-icon {
      color: var(--warning);
    }

    .topbar-link {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-decoration: none;
      padding: 0.3rem 0.5rem;
      border-radius: var(--radius-sm);
      transition: color var(--transition), background var(--transition);
    }

    .topbar-link:hover {
      color: var(--text);
      background: var(--bg-hover);
    }

    .topbar-link svg {
      width: 16px;
      height: 16px;
    }

    /* ── Examples dropdown ── */
    .examples-wrapper {
      position: relative;
    }

    .examples-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
      font-family: inherit;
      color: var(--text-muted);
      background: none;
      border: 1px solid var(--border);
      padding: 0.3rem 0.6rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: color var(--transition), background var(--transition), border-color var(--transition);
    }

    .examples-btn:hover {
      color: var(--text);
      background: var(--bg-hover);
      border-color: var(--accent);
    }

    .examples-btn svg {
      width: 14px;
      height: 14px;
    }

    .examples-btn .chevron {
      width: 10px;
      height: 10px;
      transition: transform var(--transition);
    }

    .examples-wrapper.open .chevron {
      transform: rotate(180deg);
    }

    .examples-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 6px);
      right: 0;
      width: 340px;
      max-height: 420px;
      overflow-y: auto;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 100;
      padding: 0.35rem;
    }

    .examples-wrapper.open .examples-dropdown {
      display: block;
    }

    .examples-category {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 0.5rem 0.6rem 0.25rem;
    }

    .example-item {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      padding: 0.45rem 0.6rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: background var(--transition);
    }

    .example-item:hover {
      background: var(--bg-hover);
    }

    .example-item-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text);
    }

    .example-item-desc {
      font-size: 0.7rem;
      color: var(--text-muted);
      line-height: 1.3;
    }

    .separator {
      width: 1px;
      height: 18px;
      background: var(--border);
    }

    /* ── Theme toggle ── */
    .theme-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      cursor: pointer;
      transition: color var(--transition), background var(--transition), border-color var(--transition);
      padding: 0;
    }

    .theme-btn:hover {
      color: var(--text);
      background: var(--bg-hover);
      border-color: var(--accent);
    }

    .theme-btn svg {
      width: 16px;
      height: 16px;
    }

    .theme-btn .icon-sun {
      display: none;
    }

    .theme-btn .icon-moon {
      display: block;
    }

    body.light .theme-btn .icon-sun {
      display: block;
    }

    body.light .theme-btn .icon-moon {
      display: none;
    }

    /* ── Workspace ── */
    .workspace {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ── Editor ── */
    .editor-area {
      flex: 1;
      position: relative;
      min-height: 0;
    }

    .editor-container {
      position: absolute;
      inset: 0;
    }

    /* ── Problems Panel ── */
    .problems-panel {
      flex-shrink: 0;
      background: var(--bg-elevated);
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      height: 180px;
      min-height: 33px;
      max-height: 70vh;
      position: relative;
    }

    .problems-panel.collapsed {
      height: 33px !important;
    }

    .resize-handle {
      position: absolute;
      top: -3px;
      left: 0;
      right: 0;
      height: 6px;
      cursor: ns-resize;
      z-index: 5;
    }

    .resize-handle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 0;
      right: 0;
      height: 2px;
      background: transparent;
      transition: background var(--transition);
    }

    .resize-handle:hover::after,
    .resize-handle.active::after {
      background: var(--accent);
    }

    .problems-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      height: 33px;
      min-height: 33px;
      cursor: pointer;
      user-select: none;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .problems-header:hover {
      background: var(--bg-hover);
    }

    .problems-header-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-secondary);
    }

    .problems-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      border-radius: 9px;
      font-size: 0.65rem;
      font-weight: 600;
      background: var(--error);
      color: white;
      line-height: 1;
    }

    .problems-badge.zero {
      background: var(--text-muted);
    }

    .problems-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--text-muted);
      transition: transform var(--transition);
    }

    .problems-panel.collapsed .problems-toggle {
      transform: rotate(-90deg);
    }

    .problems-body {
      flex: 1;
      overflow-y: auto;
      font-family: 'JetBrains Mono', 'Monaco', 'Menlo', monospace;
      font-size: 0.8rem;
    }

    .problems-panel.collapsed .problems-body {
      display: none;
    }

    .problems-empty {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-muted);
      font-family: 'Inter', sans-serif;
      font-size: 0.8rem;
      gap: 0.5rem;
    }

    .problems-empty svg {
      width: 16px;
      height: 16px;
      opacity: 0.5;
    }

    .problem-row {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.45rem 1rem;
      border-bottom: 1px solid rgba(42, 45, 62, 0.5);
      cursor: pointer;
      transition: background var(--transition);
    }

    .problem-row:hover {
      background: var(--bg-hover);
    }

    .problem-row:last-child {
      border-bottom: none;
    }

    .problem-icon {
      flex-shrink: 0;
      width: 16px;
      height: 16px;
      margin-top: 1px;
      color: var(--error);
    }

    .problem-message {
      flex: 1;
      color: var(--text);
      line-height: 1.5;
      word-break: break-word;
    }

    .problem-location {
      flex-shrink: 0;
      color: var(--text-muted);
      font-size: 0.75rem;
      white-space: nowrap;
      margin-top: 1px;
    }

    .problem-category {
      flex-shrink: 0;
      font-size: 0.65rem;
      font-weight: 500;
      padding: 0.15rem 0.45rem;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      background: var(--error-subtle);
      color: var(--error);
      border: 1px solid var(--error-border);
      margin-top: 1px;
    }

    /* ── Status bar ── */
    .statusbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 0.75rem;
      height: 24px;
      background: var(--accent);
      flex-shrink: 0;
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .statusbar-left,
    .statusbar-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .statusbar-item {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: default;
    }

    .statusbar-item svg {
      width: 12px;
      height: 12px;
    }

    /* ── Scrollbar styling ── */
    .problems-body::-webkit-scrollbar {
      width: 8px;
    }

    .problems-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .problems-body::-webkit-scrollbar-thumb {
      background: var(--bg-hover);
      border-radius: 4px;
    }

    .problems-body::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* ── Responsive ── */
    @media (max-width: 640px) {
      .topbar {
        padding: 0 0.75rem;
      }

      .problems-header {
        padding: 0 0.75rem;
      }

      .problem-row {
        padding: 0.45rem 0.75rem;
      }

      .problem-category {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-left">
      <div class="logo">
        <div class="logo-mark">C</div>
        <span>CDDL Playground</span>
      </div>
      <div class="separator"></div>
      <div class="status-pill" id="statusPill">
        <span class="status-dot"></span>
        <span id="statusText">Ready</span>
      </div>
    </div>

    <div class="topbar-right">
      <label class="toggle-group" id="refCheckToggle" title="Check for undefined type/group references">
        <span>Ref checks</span>
        <div class="toggle-track" id="refCheckTrack">
          <div class="toggle-knob"></div>
        </div>
      </label>
      <label class="toggle-group" id="formatToggle" title="Format CDDL when pressing Ctrl+S / Cmd+S">
        <span>Format on save</span>
        <div class="toggle-track" id="formatTrack">
          <div class="toggle-knob"></div>
        </div>
      </label>
      <div class="separator"></div>
      <div class="examples-wrapper" id="examplesWrapper">
        <button class="examples-btn" id="examplesBtn" title="Browse CDDL examples">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
          </svg>
          Examples
          <svg class="chevron" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="3 5 6 8 9 5" />
          </svg>
        </button>
        <div class="examples-dropdown" id="examplesDropdown"></div>
      </div>
      <div class="separator"></div>
      <a href="https://tools.ietf.org/html/rfc8610" target="_blank" rel="noopener" class="topbar-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
          <polyline points="14 2 14 8 20 8" />
          <line x1="16" y1="13" x2="8" y2="13" />
          <line x1="16" y1="17" x2="8" y2="17" />
          <polyline points="10 9 9 9 8 9" />
        </svg>
        RFC 8610
      </a>
      <a href="https://github.com/anweiss/cddl" target="_blank" rel="noopener" class="topbar-link">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z" />
        </svg>
        GitHub
      </a>
      <button class="theme-btn" id="themeToggle" title="Toggle light/dark mode">
        <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
        </svg>
        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5" />
          <line x1="12" y1="1" x2="12" y2="3" />
          <line x1="12" y1="21" x2="12" y2="23" />
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
          <line x1="1" y1="12" x2="3" y2="12" />
          <line x1="21" y1="12" x2="23" y2="12" />
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Main workspace -->
  <div class="workspace">
    <!-- Editor -->
    <div class="editor-area">
      <div class="editor-container" id="cddlEditor"></div>
    </div>

    <!-- Problems Panel (inline debugger) -->
    <div class="problems-panel" id="problemsPanel">
      <div class="resize-handle" id="resizeHandle"></div>
      <div class="problems-header" id="problemsHeader">
        <div class="problems-header-left">
          <span>Problems</span>
          <span class="problems-badge zero" id="problemsBadge">0</span>
        </div>
        <div class="problems-toggle" id="problemsToggle">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="3 5 6 8 9 5" />
          </svg>
        </div>
      </div>
      <div class="problems-body" id="problemsBody">
        <div class="problems-empty" id="problemsEmpty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
            <polyline points="22 4 12 14.01 9 11.01" />
          </svg>
          No problems detected
        </div>
      </div>
    </div>
  </div>

  <!-- Status bar -->
  <div class="statusbar">
    <div class="statusbar-left">
      <span class="statusbar-item" id="cursorPosition">Ln 1, Col 1</span>
    </div>
    <div class="statusbar-right">
      <span class="statusbar-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
        </svg>
        Rust + WASM
      </span>
      <span class="statusbar-item">CDDL</span>
    </div>
  </div>

</body>

</html>